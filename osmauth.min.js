!function(f){"object"==typeof exports&&"undefined"!=typeof module?module.exports=f():"function"==typeof define&&define.amd?define([],f):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).osmAuth=f()}(function(){var define,module,exports;return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";var ohauth=require("ohauth"),store=require("store");module.exports=function(o){var storage,token,oauth={authenticated:function(){return!!token("access_token")},logout:function(){return token("access_token",""),oauth}};return oauth.authenticate=function(callback){if(oauth.authenticated())return callback();oauth.logout();var url=o.url+"/oauth2/authorize?"+ohauth.qsString({client_id:o.client_id,redirect_uri:o.redirect_uri,response_type:"code",scope:o.scope});if(!o.singlepage){var settings=[["width",600],["height",550],["left",screen.width/2-300],["top",screen.height/2-275]].map(function(x){return x.join("=")}).join(","),settings=window.open("about:blank","oauth_window",settings);if((oauth.popupWindow=settings).location=url,!settings)throw(url=new Error("Popup was blocked")).status="popup-blocked",url}function accessTokenDone(err,xhr){if(o.done(),err)return callback(err);err=JSON.parse(xhr.response);token("access_token",err.access_token),callback(null,oauth)}window.authComplete=function(url){!function(auth_code){auth_code=o.url+"/oauth2/token?"+ohauth.qsString({client_id:o.client_id,grant_type:"authorization_code",code:auth_code,redirect_uri:o.redirect_uri,client_secret:o.client_secret});ohauth.xhr("POST",auth_code,null,null,{},accessTokenDone),o.loading()}(ohauth.stringQs(url.split("?")[1]).code),delete window.authComplete}},oauth.bringPopupWindowToFront=function(){var brougtPopupToFront=!1;try{oauth.popupWindow&&!oauth.popupWindow.closed&&(oauth.popupWindow.focus(),brougtPopupToFront=!0)}catch(err){}return brougtPopupToFront},oauth.bootstrapToken=function(auth_code,callback){function accessTokenDone(err,xhr){if(o.done(),err)return callback(err);err=JSON.parse(xhr.response);token("access_token",err.access_token),callback(null,oauth)}!function(auth_code){auth_code=o.url+"/oauth2/token?"+ohauth.qsString({client_id:o.client_id,grant_type:"authorization_code",code:auth_code,redirect_uri:o.redirect_uri,client_secret:o.client_secret}),ohauth.xhr("POST",auth_code,null,null,{},accessTokenDone),o.loading()}(auth_code)},oauth.xhr=function(options,callback){return oauth.authenticated()?run():o.auto?oauth.authenticate(run):void callback("not authenticated",null);function run(){var url=!1!==options.prefix?o.url+options.path:options.path;return ohauth.xhr(options.method,url,token("access_token"),options.content,options.options,done)}function done(err,xhr){return err?callback(err):xhr.responseXML?callback(err,xhr.responseXML):callback(err,xhr.response)}},oauth.preauth=function(c){if(c)return c.access_token&&token("access_token",c.access_token),oauth},oauth.options=function(_){return arguments.length?((o=_).url=o.url||"https://www.openstreetmap.org",o.singlepage=o.singlepage||!1,o.loading=o.loading||function(){},o.done=o.done||function(){},oauth.preauth(o)):o},token=store.enabled?function(x,y){return 1===arguments.length?store.get(o.url+x):2===arguments.length?store.set(o.url+x,y):void 0}:(storage={},function(x,y){return 1===arguments.length?storage[o.url+x]:2===arguments.length?storage[o.url+x]=y:void 0}),oauth.options(o),oauth}},{ohauth:2,store:3}],2:[function(require,module,exports){"use strict";var ohauth={qsString:function(obj){return Object.keys(obj).sort().map(function(key){return ohauth.percentEncode(key)+"="+ohauth.percentEncode(obj[key])}).join("&")},stringQs:function(str){return str.split("&").filter(function(pair){return""!==pair}).reduce(function(obj,pair){pair=pair.split("=");return obj[decodeURIComponent(pair[0])]=null===pair[1]?"":decodeURIComponent(pair[1]),obj},{})},rawxhr:function(method,url,data,headers,callback){var h,xhr=new XMLHttpRequest,twoHundred=/^20\d$/;for(h in xhr.onreadystatechange=function(){if(4===xhr.readyState&&0!==xhr.status){if(!twoHundred.test(xhr.status))return callback(xhr,null);callback(null,xhr)}},xhr.onerror=function(e){return callback(e,null)},xhr.open(method,url,!0),headers)xhr.setRequestHeader(h,headers[h]);return xhr.send(data),xhr},xhr:function(method,url,access_token,data,options,callback){options=options&&options.header||{"Content-Type":"application/x-www-form-urlencoded"};return options.Authorization="Bearer "+access_token,ohauth.rawxhr(method,url,data,options,callback)},percentEncode:function(s){return encodeURIComponent(s).replace(/\!/g,"%21").replace(/\'/g,"%27").replace(/\*/g,"%2A").replace(/\(/g,"%28").replace(/\)/g,"%29")}};module.exports=ohauth},{}],3:[function(require,module,exports){var engine=require("../src/store-engine"),storages=require("../storages/all"),require=[require("../plugins/json2")];module.exports=engine.createStore(storages,require)},{"../plugins/json2":4,"../src/store-engine":6,"../storages/all":8}],4:[function(require,module,exports){module.exports=function(){return require("./lib/json2"),{}}},{"./lib/json2":5}],5:[function(require,module,exports){"object"!=typeof JSON&&(JSON={}),!function(){"use strict";var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta,rep;function f(n){return n<10?"0"+n:n}function this_value(){return this.valueOf()}function quote(string){return rx_escapable.lastIndex=0,rx_escapable.test(string)?'"'+string.replace(rx_escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];switch(value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key)),typeof(value="function"==typeof rep?rep.call(holder,key,value):value)){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;i<length;i+=1)partial[i]=str(i,value)||"null";return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"==typeof rep)for(length=rep.length,i=0;i<length;i+=1)"string"==typeof rep[i]&&(v=str(k=rep[i],value))&&partial.push(quote(k)+(gap?": ":":")+v);else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value))&&partial.push(quote(k)+(gap?": ":":")+v);return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value),"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(value,replacer,space){var i;if(indent=gap="","number"==typeof space)for(i=0;i<space;i+=1)indent+=" ";else"string"==typeof space&&(indent=space);if(!(rep=replacer)||"function"==typeof replacer||"object"==typeof replacer&&"number"==typeof replacer.length)return str("",{"":value});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(void 0!==(v=walk(value,k))?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()},{}],6:[function(require,module,exports){var require=require("./util"),slice=require.slice,pluck=require.pluck,each=require.each,bind=require.bind,create=require.create,isList=require.isList,isFunction=require.isFunction,isObject=require.isObject,storeAPI={version:"2.0.12",enabled:!(module.exports={createStore:createStore}),get:function(key,optionalDefaultValue){key=this.storage.read(this._namespacePrefix+key);return this._deserialize(key,optionalDefaultValue)},set:function(key,value){return void 0===value?this.remove(key):(this.storage.write(this._namespacePrefix+key,this._serialize(value)),value)},remove:function(key){this.storage.remove(this._namespacePrefix+key)},each:function(callback){var self=this;this.storage.each(function(val,namespacedKey){callback.call(self,self._deserialize(val),(namespacedKey||"").replace(self._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(namespace){return this._namespacePrefix=="__storejs_"+namespace+"_"},createStore:function(){return createStore.apply(this,arguments)},addPlugin:function(plugin){this._addPlugin(plugin)},namespace:function(namespace){return createStore(this.storage,this.plugins,namespace)}};function createStore(storages,plugins,namespace){namespace=namespace||"",storages&&!isList(storages)&&(storages=[storages]),plugins&&!isList(plugins)&&(plugins=[plugins]);var namespacePrefix=namespace?"__storejs_"+namespace+"_":"",namespaceRegexp=namespace?new RegExp("^"+namespacePrefix):null;if(!/^[a-zA-Z0-9_\-]*$/.test(namespace))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var store=create({_namespacePrefix:namespacePrefix,_namespaceRegexp:namespaceRegexp,_testStorage:function(storage){try{var testStr="__storejs__test__",ok=(storage.write(testStr,testStr),storage.read(testStr)===testStr);return storage.remove(testStr),ok}catch(e){return!1}},_assignPluginFnProp:function(pluginFnProp,propName){var oldFn=this[propName];this[propName]=function(){var args=slice(arguments,0),self=this;var newFnArgs=[function(){if(oldFn)return each(arguments,function(arg,i){args[i]=arg}),oldFn.apply(self,args)}].concat(args);return pluginFnProp.apply(self,newFnArgs)}},_serialize:function(obj){return JSON.stringify(obj)},_deserialize:function(strVal,defaultVal){if(!strVal)return defaultVal;var val="";try{val=JSON.parse(strVal)}catch(e){val=strVal}return void 0!==val?val:defaultVal},_addStorage:function(storage){this.enabled||this._testStorage(storage)&&(this.storage=storage,this.enabled=!0)},_addPlugin:function(plugin){var self=this;if(isList(plugin))each(plugin,function(plugin){self._addPlugin(plugin)});else{var seenPlugin=pluck(this.plugins,function(seenPlugin){return plugin===seenPlugin});if(!seenPlugin){if(this.plugins.push(plugin),!isFunction(plugin))throw new Error("Plugins must be function values that return objects");seenPlugin=plugin.call(this);if(!isObject(seenPlugin))throw new Error("Plugins must return an object of function properties");each(seenPlugin,function(pluginFnProp,propName){if(!isFunction(pluginFnProp))throw new Error("Bad plugin property: "+propName+" from plugin "+plugin.name+". Plugins should only return functions.");self._assignPluginFnProp(pluginFnProp,propName)})}}},addStorage:function(storage){!function(){var _console="undefined"==typeof console?null:console;_console&&(_console.warn||_console.log).apply(_console,arguments)}("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(storage)}},storeAPI,{plugins:[]});return store.raw={},each(store,function(prop,propName){isFunction(prop)&&(store.raw[propName]=bind(store,prop))}),each(storages,function(storage){store._addStorage(storage)}),each(plugins,function(plugin){store._addPlugin(plugin)}),store}},{"./util":7}],7:[function(require,module,exports){!function(global){!function(){var assign=Object.assign||function(obj,props1,props2,etc){for(var i=1;i<arguments.length;i++)each(Object(arguments[i]),function(val,key){obj[key]=val});return obj},create=function(){{function F(){}return Object.create?function(obj,assignProps1,assignProps2,etc){var assignArgsList=slice(arguments,1);return assign.apply(this,[Object.create(obj)].concat(assignArgsList))}:function(obj,assignProps1,assignProps2,etc){var assignArgsList=slice(arguments,1);return F.prototype=obj,assign.apply(this,[new F].concat(assignArgsList))}}}(),trim=String.prototype.trim?function(str){return String.prototype.trim.call(str)}:function(str){return str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},Global="undefined"!=typeof window?window:global;function slice(arr,index){return Array.prototype.slice.call(arr,index||0)}function each(obj,fn){pluck(obj,function(val,key){fn(val,key)})}function pluck(obj,fn){if(isList(obj)){for(var i=0;i<obj.length;i++)if(fn(obj[i],i))return obj[i]}else for(var key in obj)if(obj.hasOwnProperty(key)&&fn(obj[key],key))return obj[key]}function isList(val){return null!=val&&"function"!=typeof val&&"number"==typeof val.length}module.exports={assign:assign,create:create,trim:trim,bind:function(obj,fn){return function(){return fn.apply(obj,Array.prototype.slice.call(arguments,0))}},slice:slice,each:each,map:function(obj,fn){var res=isList(obj)?[]:{};return pluck(obj,function(v,k){res[k]=fn(v,k)}),res},pluck:pluck,isList:isList,isFunction:function(val){return val&&"[object Function]"==={}.toString.call(val)},isObject:function(val){return val&&"[object Object]"==={}.toString.call(val)},Global:Global}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(require,module,exports){module.exports=[require("./localStorage"),require("./oldFF-globalStorage"),require("./oldIE-userDataStorage"),require("./cookieStorage"),require("./sessionStorage"),require("./memoryStorage")]},{"./cookieStorage":9,"./localStorage":10,"./memoryStorage":11,"./oldFF-globalStorage":12,"./oldIE-userDataStorage":13,"./sessionStorage":14}],9:[function(require,module,exports){var require=require("../src/util"),Global=require.Global,trim=require.trim,doc=(module.exports={name:"cookieStorage",read:function(key){if(!key||!_has(key))return null;key="(?:^|.*;\\s*)"+escape(key).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(doc.cookie.replace(new RegExp(key),"$1"))},write:function(key,data){key&&(doc.cookie=escape(key)+"="+escape(data)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")},each:each,remove:remove,clearAll:function(){each(function(_,key){remove(key)})}},Global.document);function each(callback){for(var kvp,key,cookies=doc.cookie.split(/; ?/g),i=cookies.length-1;0<=i;i--)trim(cookies[i])&&(kvp=cookies[i].split("="),key=unescape(kvp[0]),callback(unescape(kvp[1]),key))}function remove(key){key&&_has(key)&&(doc.cookie=escape(key)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function _has(key){return new RegExp("(?:^|;\\s*)"+escape(key).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(doc.cookie)}},{"../src/util":7}],10:[function(require,module,exports){var Global=require("../src/util").Global;function localStorage(){return Global.localStorage}function read(key){return localStorage().getItem(key)}module.exports={name:"localStorage",read:read,write:function(key,data){return localStorage().setItem(key,data)},each:function(fn){for(var i=localStorage().length-1;0<=i;i--){var key=localStorage().key(i);fn(read(key),key)}},remove:function(key){return localStorage().removeItem(key)},clearAll:function(){return localStorage().clear()}}},{"../src/util":7}],11:[function(require,module,exports){module.exports={name:"memoryStorage",read:function(key){return memoryStorage[key]},write:function(key,data){memoryStorage[key]=data},each:function(callback){for(var key in memoryStorage)memoryStorage.hasOwnProperty(key)&&callback(memoryStorage[key],key)},remove:function(key){delete memoryStorage[key]},clearAll:function(key){memoryStorage={}}};var memoryStorage={}},{}],12:[function(require,module,exports){var require=require("../src/util").Global,globalStorage=(module.exports={name:"oldFF-globalStorage",read:function(key){return globalStorage[key]},write:function(key,data){globalStorage[key]=data},each:each,remove:function(key){return globalStorage.removeItem(key)},clearAll:function(){each(function(key,_){delete globalStorage[key]})}},require.globalStorage);function each(fn){for(var i=globalStorage.length-1;0<=i;i--){var key=globalStorage.key(i);fn(globalStorage[key],key)}}},{"../src/util":7}],13:[function(require,module,exports){var require=require("../src/util").Global,storageName=(module.exports={name:"oldIE-userDataStorage",write:function(unfixedKey,data){var fixedKey;disable||(fixedKey=fixKey(unfixedKey),_withStorageEl(function(storageEl){storageEl.setAttribute(fixedKey,data),storageEl.save(storageName)}))},read:function(unfixedKey){var fixedKey,res;if(!disable)return fixedKey=fixKey(unfixedKey),res=null,_withStorageEl(function(storageEl){res=storageEl.getAttribute(fixedKey)}),res},each:function(callback){_withStorageEl(function(storageEl){for(var attributes=storageEl.XMLDocument.documentElement.attributes,i=attributes.length-1;0<=i;i--){var attr=attributes[i];callback(storageEl.getAttribute(attr.name),attr.name)}})},remove:function(unfixedKey){var fixedKey=fixKey(unfixedKey);_withStorageEl(function(storageEl){storageEl.removeAttribute(fixedKey),storageEl.save(storageName)})},clearAll:function(){_withStorageEl(function(storageEl){var attributes=storageEl.XMLDocument.documentElement.attributes;storageEl.load(storageName);for(var i=attributes.length-1;0<=i;i--)storageEl.removeAttribute(attributes[i].name);storageEl.save(storageName)})}},"storejs"),doc=require.document,_withStorageEl=function(){if(!doc||!doc.documentElement||!doc.documentElement.addBehavior)return null;var storageOwner,storageContainer,storageEl;try{(storageContainer=new ActiveXObject("htmlfile")).open(),storageContainer.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></iframe>'),storageContainer.close(),storageOwner=storageContainer.w.frames[0].document,storageEl=storageOwner.createElement("div")}catch(e){storageEl=doc.createElement("div"),storageOwner=doc.body}return function(storeFunction){var args=[].slice.call(arguments,0);args.unshift(storageEl),storageOwner.appendChild(storageEl),storageEl.addBehavior("#default#userData"),storageEl.load(storageName),storeFunction.apply(this,args),storageOwner.removeChild(storageEl)}}(),disable=(require.navigator?require.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./);var forbiddenCharsRegex=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function fixKey(key){return key.replace(/^\d/,"___$&").replace(forbiddenCharsRegex,"___")}},{"../src/util":7}],14:[function(require,module,exports){var Global=require("../src/util").Global;function sessionStorage(){return Global.sessionStorage}function read(key){return sessionStorage().getItem(key)}module.exports={name:"sessionStorage",read:read,write:function(key,data){return sessionStorage().setItem(key,data)},each:function(fn){for(var i=sessionStorage().length-1;0<=i;i--){var key=sessionStorage().key(i);fn(read(key),key)}},remove:function(key){return sessionStorage().removeItem(key)},clearAll:function(){return sessionStorage().clear()}}},{"../src/util":7}]},{},[1])(1)});
